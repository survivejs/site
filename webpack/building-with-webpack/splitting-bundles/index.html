<html lang="en"><head><title>SurviveJS - Splitting Bundles</title><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimal-ui"/><meta name="description" content="
Currently the production version of our application is a single JavaScript file. This isn&#x27;t ideal. If we change the application, the client must download vendor dependencies as well.

It would be better to download only the changed portion. If the vendor dependencies change, then the client should …"/><meta name="keywords" content="webpack,react,javascript,programming,web development"/><link rel="icon" type="image/png" href="/assets/img/favicon.png"/><link rel="alternate" type="application/atom+xml" href="/atom.xml"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"/><link rel="stylesheet" href="/assets/main.css"/></head><body><main role="main"><div class="chapter__wrapper"><div class="header-image" style="background-image:url(/assets/img/chapters/bundle.jpg);"></div><h1 class="post__heading">Splitting Bundles</h1><div class="header-extra"><a href="https://pixabay.com/en/books-student-study-education-1012088/">stevepb (Public Domain)</a></div><div class="toc-nav__wrapper"><h4 class="search-nav--header">Search</h4><input id="search"/><h4 class="toc-nav--header">Table of Contents</h4><ul class="toc-nav"><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/introduction">Introduction</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/webpack-compared">Webpack Compared</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/why-webpack">Why Webpack?</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/developing-with-webpack">Developing with Webpack</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/getting-started">Getting Started</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/splitting-configuration">Splitting the Configuration</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/automatic-browser-refresh">Automatic Browser Refresh</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/configuring-hmr">Configuring Hot Module Replacement</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing-with-webpack/linting">Linting JavaScript</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/handling-styles">Handling Styles with Webpack</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/handling-styles/loading">Loading Styles</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/handling-styles/separating-css">Separating CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/handling-styles/eliminating-unused-css">Eliminating Unused CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/handling-styles/linting">Linting CSS</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/understanding-loaders">Understanding Loaders</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/understanding-loaders/loader-definitions">Loader Definitions</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/understanding-loaders/loading-images">Loading Images</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/understanding-loaders/loading-fonts">Loading Fonts</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/understanding-loaders/writing-loaders">Writing Loaders</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/building-with-webpack">Building with Webpack</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/enabling-sourcemaps">Enabling Sourcemaps</a></li><li class="toc-chapter"><span class="toc-nav__link toc-nav__link--current chapter">Splitting Bundles</span></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/code-splitting">Code Splitting</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/processing-with-babel">Processing with Babel</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/cleaning-build">Cleaning the Build</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building-with-webpack/hosting-on-github-pages">Hosting on GitHub Pages</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/optimizing-build">Optimizing Build</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing-build/minifying">Minifying the Build</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing-build/setting-environment-variables">Setting Environment Variables</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing-build/adding-hashes-to-filenames">Adding Hashes to Filenames</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing-build/analyzing-build-statistics">Analyzing Build Statistics</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/advanced-techniques">Advanced Techniques</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/advanced-techniques/consuming-packages">Consuming Packages</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/advanced-techniques/authoring-packages">Authoring Packages</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/advanced-techniques/configuring-react">Configuring React</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/appendices">Appendices</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/searching-with-react">Searching with React</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/configuring-hmr-with-react">Configuring Hot Module Replacement with React</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/writing-eslint-plugins">Writing ESLint Plugins</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/customizing-eslint">Customizing ESLint</a></li></ul><div><div class="buy-container"><a href="/webpack/introduction"><img class="sidebar-cover" src="/assets/img/webpack_title_page_small.png" width="255" height="329"/></a><p><a class="btn btn--normal btn--buy" href="https://leanpub.com/survivejs-webpack">Buy at Leanpub</a></p></div><h3>See also</h3><div class="buy-container"><a href="/react/introduction"><img class="sidebar-cover" src="/assets/img/react_title_page_small.png" width="255" height="329"/></a><p><a class="btn btn--normal btn--buy" href="https://leanpub.com/survivejs-react">Buy at Leanpub</a></p></div></div></div><div class="chapter"><div class="post__content"><blockquote class="latestpost tip"><div>From the blog:</div><a class="latestpost-link" href="/blog/isomorphic-webpack-interview">isomorphic-webpack - Universal module consumption using webpack - Interview with Gajus Kuizinas</a></blockquote><div class="chapter-content"><p>Currently the production version of our application is a single JavaScript file. This isn&#39;t ideal. If we change the application, the client must download vendor dependencies as well.</p>
<p>It would be better to download only the changed portion. If the vendor dependencies change, then the client should fetch only the vendor dependencies. The same goes for actual application code. This technique is known as <strong>bundle splitting</strong>.</p>
<h2 class="header"><a class="header-anchor" href="#the-idea-of-bundle-splitting" id="the-idea-of-bundle-splitting"></a><span class="text">The Idea of Bundle Splitting</span><a class="header-anchor-select" href="#the-idea-of-bundle-splitting">#</a></h2>
<p>Using bundle splitting, we can push the vendor dependencies to a bundle of its own and benefit from client level caching. We can do this in a such way that the whole size of the application remains the same. Given there are more requests to perform, there&#39;s a slight overhead. But the benefit of caching makes up for this cost.</p>
<p>To give you a simple example, instead of having <em>app.js</em> (100 kB), we could end up with <em>app.js</em> (10 kB) and <em>vendor.js</em> (90 kB). Now changes made to the application are cheap for the clients that have already used the application earlier.</p>
<p>Caching comes with its own problems. One of those is cache invalidation. We&#39;ll discuss a potential approach related to that in the <em>Adding Hashes to Filenames</em> chapter.</p>
<p>Bundle splitting isn&#39;t the only way out. In the next chapter, we will discuss a more granular technique known as <em>code splitting</em> that allows us to load code on demand.</p>
<h2 class="header"><a class="header-anchor" href="#adding-something-to-split" id="adding-something-to-split"></a><span class="text">Adding Something to Split</span><a class="header-anchor-select" href="#adding-something-to-split">#</a></h2>
<p>Given there&#39;s not much to split into the vendor bundle yet, we should add something there. Add React to the project first:</p>
<pre><code class="lang-bash">npm i react --save
</code></pre>
<p>Then make the project depend on it:</p>
<p><strong>app/index.js</strong></p>
<pre><code><div class="leanpub-insert">
<span class="token function" >import</span> <span class="token string" >'react'</span><span class="token punctuation" >;</span>
</div>
<span class="token function" >import</span> <span class="token string" >'purecss'</span><span class="token punctuation" >;</span>
<span class="token function" >import</span> <span class="token string" >'./main.css'</span><span class="token punctuation" >;</span>
<span class="token function" >import</span> component from <span class="token string" >'./component'</span><span class="token punctuation" >;</span>

<span class="token punctuation" >..</span>.
</code></pre><p>Execute <code>npm run build</code> to get a baseline build. You should end up with something like this:</p>
<pre><code class="lang-bash">Hash: 33ce6392fbaece211262
Version: webpack 2.2.0-rc.3
Time: 1864ms
      Asset       Size  Chunks             Chunk Names
     app.js     140 kB       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
    app.css    2.18 kB       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
 app.js.map     165 kB       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
app.css.map   84 bytes       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
 index.html  218 bytes          <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
   <span class="token punctuation" >[</span>3<span class="token punctuation" >]</span> ./~/react/lib/ReactElement.js 11.2 kB <span class="token punctuation" >{</span>0<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
   <span class="token punctuation" >[</span>5<span class="token punctuation" >]</span> ./~/object-assign/index.js 1.99 kB <span class="token punctuation" >{</span>0<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
   <span class="token punctuation" >[</span>9<span class="token punctuation" >]</span> ./~/react/lib/ReactComponent.js 4.61 kB <span class="token punctuation" >{</span>0<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
<span class="token punctuation" >..</span>.
</code></pre>
<p>As you can see, <em>app.js</em> is quite big. This is exactly what we wanted. We must do something about this next.</p>
<h2 class="header"><a class="header-anchor" href="#setting-up-a-vendor-bundle" id="setting-up-a-vendor-bundle"></a><span class="text">Setting Up a <code>vendor</code> Bundle</span><a class="header-anchor-select" href="#setting-up-a-vendor-bundle">#</a></h2>
<p>So far our project has only a single entry named as <code>app</code>. As you might remember, our configuration tells webpack to traverse dependencies starting from the <code>app</code> entry directory and then to output the resulting bundle below our <code>build</code> directory using the entry name and <code>.js</code> extension.</p>
<p>To improve the situation, we can define a <code>vendor</code> entry containing React. This is done by matching the dependency name. It is possible to generate this information automatically as discussed at the end of this chapter, but I&#39;ll go with a static array here to illustrate the basic idea. Change the code like this:</p>
<pre><code class="lang-javascript"><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>

module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span>env<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >if</span> <span class="token punctuation" >(</span>env <span class="token operator" >===</span> <span class="token string" >'production'</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token keyword" >return</span> <span class="token function" >merge</span><span class="token punctuation" >(</span>
      common<span class="token punctuation" >,</span>
<div class="leanpub-insert">
      <span class="token punctuation" >{</span>
        entry<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
          vendor<span class="token punctuation" >:</span> <span class="token punctuation" >[</span><span class="token string" >'react'</span><span class="token punctuation" >]</span>
        <span class="token punctuation" >}</span>
      <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
</div>
      parts<span class="token punctuation" >.</span><span class="token function" >generateSourcemaps</span><span class="token punctuation" >(</span><span class="token string" >'source-map'</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
      parts<span class="token punctuation" >.</span><span class="token function" >extractCSS</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
      parts<span class="token punctuation" >.</span><span class="token function" >purifyCSS</span><span class="token punctuation" >(</span>PATHS<span class="token punctuation" >.</span>app<span class="token punctuation" >)</span>
    <span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation" >}</span>

  <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>
</code></pre>
<p>We have two separate entries, or <strong>entry chunks</strong>, now. <code>[name].js</code> of our existing <code>output.path</code> configuration will kick in based on the entry name and if you try to generate a build now (<code>npm run build</code>), you should see something like this:</p>
<pre><code class="lang-bash">Hash: 18370a70583cfc914334
Version: webpack 2.2.0-rc.3
Time: 1921ms
        Asset       Size  Chunks             Chunk Names
       app.js     140 kB       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
    vendor.js     138 kB       1  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  vendor
      app.css    2.18 kB       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
   app.js.map     165 kB       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
  app.css.map   84 bytes       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
vendor.js.map     164 kB       1  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  vendor
   index.html  274 bytes          <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
   <span class="token punctuation" >[</span>3<span class="token punctuation" >]</span> ./~/react/lib/ReactElement.js 11.2 kB <span class="token punctuation" >{</span>0<span class="token punctuation" >}</span> <span class="token punctuation" >{</span>1<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
   <span class="token punctuation" >[</span>5<span class="token punctuation" >]</span> ./~/object-assign/index.js 1.99 kB <span class="token punctuation" >{</span>0<span class="token punctuation" >}</span> <span class="token punctuation" >{</span>1<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
<span class="token punctuation" >..</span>.
</code></pre>
<p><em>app.js</em> and <em>vendor.js</em> have separate chunk ids right now given they are entry chunks of their own. The output size is a little off, though. <em>app.js</em> should be significantly smaller to attain our goal with this build.</p>
<p>If you examine the resulting bundle, you can see that it contains React given that&#39;s how the default definition works. Webpack pulls the related dependencies to a bundle by default as illustrated by the image below:</p>
<p><img src="/webpack/images/bundle_01.png" alt="Separate app and vendor bundles"></p>
<p>A webpack plugin known as <code>CommonsChunkPlugin</code> allows us alter this default behavior so that we can get the bundles we might expect.</p>
<blockquote class="warning"><i class="icon-attention"></i>This step can fail on Windows due to letter casing. Instead of <code>c:\</code> you may need to force your terminal to read <code>C:\</code>. There&#39;s more information in the <a href="https://github.com/webpack/webpack/issues/2362">related webpack issue</a>.</blockquote><blockquote class="warning"><i class="icon-attention"></i>Webpack doesn&#39;t allow referring to entry files within entries. If you inadvertently do this, webpack will complain loudly. If you end up in a case like this, consider refactoring the module structure of your code to eliminate the situation.</blockquote><h2 class="header"><a class="header-anchor" href="#setting-up-commonschunkplugin-" id="setting-up-commonschunkplugin-"></a><span class="text">Setting Up <code>CommonsChunkPlugin</code></span><a class="header-anchor-select" href="#setting-up-commonschunkplugin-">#</a></h2>
<p><a href="https://webpack.js.org/guides/code-splitting-libraries/#commonschunkplugin">CommonsChunkPlugin</a> is a powerful and complex plugin. The use case we are covering here is a basic yet useful one. As before, we can define a function that wraps the basic idea.</p>
<p>The following code combines the <code>entry</code> idea above with a basic <code>CommonsChunkPlugin</code> setup. It has been designed so that it is possible to access advanced features of <code>CommonsChunkPlugin</code> while allowing you to define multiple splits through it.</p>
<p><strong>webpack.parts.js</strong></p>
<pre><code class="lang-javascript"><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>

<div class="leanpub-insert">
exports<span class="token punctuation" >.</span>extractBundles <span class="token operator" >=</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span>bundles<span class="token punctuation" >,</span> options<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >const</span> entry <span class="token operator" >=</span> <span class="token punctuation" >{</span><span class="token punctuation" >}</span><span class="token punctuation" >;</span>
  <span class="token keyword" >const</span> names <span class="token operator" >=</span> <span class="token punctuation" >[</span><span class="token punctuation" >]</span><span class="token punctuation" >;</span>

  <span class="token comment" spellcheck="true">// Set up entries and names.</span>
  bundles<span class="token punctuation" >.</span><span class="token function" >forEach</span><span class="token punctuation" >(</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span> name<span class="token punctuation" >,</span> entries <span class="token punctuation" >}</span><span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> <span class="token punctuation" >{</span>
    <span class="token keyword" >if</span> <span class="token punctuation" >(</span>entries<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
      entry<span class="token punctuation" >[</span>name<span class="token punctuation" >]</span> <span class="token operator" >=</span> entries<span class="token punctuation" >;</span>
    <span class="token punctuation" >}</span>

    names<span class="token punctuation" >.</span><span class="token function" >push</span><span class="token punctuation" >(</span>name<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

  <span class="token keyword" >return</span> <span class="token punctuation" >{</span>
    <span class="token comment" spellcheck="true">// Define an entry point needed for splitting.</span>
    entry<span class="token punctuation" >,</span>
    plugins<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
      <span class="token comment" spellcheck="true">// Extract bundles.</span>
      <span class="token keyword" >new</span> <span class="token class-name" >webpack<span class="token punctuation" >.</span>optimize<span class="token punctuation" >.</span>CommonsChunkPlugin</span><span class="token punctuation" >(</span>
        Object<span class="token punctuation" >.</span><span class="token function" >assign</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span><span class="token punctuation" >}</span><span class="token punctuation" >,</span> options<span class="token punctuation" >,</span> <span class="token punctuation" >{</span> names <span class="token punctuation" >}</span><span class="token punctuation" >)</span>
      <span class="token punctuation" >)</span>
    <span class="token punctuation" >]</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>
</div>
</code></pre>
<p>Given the function handles the entry for us, we can drop our <code>vendor</code> related configuration and use the function instead:</p>
<p><strong>webpack.config.js</strong></p>
<pre><code class="lang-javascript"><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>

module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span>env<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >if</span> <span class="token punctuation" >(</span>env <span class="token operator" >===</span> <span class="token string" >'production'</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
    <span class="token keyword" >return</span> <span class="token function" >merge</span><span class="token punctuation" >(</span>
      common<span class="token punctuation" >,</span>
<div class="leanpub-delete">
      <span class="token punctuation" >{</span>
        entry<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
          vendor<span class="token punctuation" >:</span> <span class="token punctuation" >[</span><span class="token string" >'react'</span><span class="token punctuation" >]</span>
        <span class="token punctuation" >}</span>
      <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
</div>
<div class="leanpub-insert">
      parts<span class="token punctuation" >.</span><span class="token function" >extractBundles</span><span class="token punctuation" >(</span><span class="token punctuation" >[</span>
        <span class="token punctuation" >{</span>
          name<span class="token punctuation" >:</span> <span class="token string" >'vendor'</span><span class="token punctuation" >,</span>
          entries<span class="token punctuation" >:</span> <span class="token punctuation" >[</span><span class="token string" >'react'</span><span class="token punctuation" >]</span>
        <span class="token punctuation" >}</span>
      <span class="token punctuation" >]</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
</div>
      parts<span class="token punctuation" >.</span><span class="token function" >generateSourcemaps</span><span class="token punctuation" >(</span><span class="token string" >'source-map'</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
      parts<span class="token punctuation" >.</span><span class="token function" >extractCSS</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
      parts<span class="token punctuation" >.</span><span class="token function" >purifyCSS</span><span class="token punctuation" >(</span>PATHS<span class="token punctuation" >.</span>app<span class="token punctuation" >)</span>
    <span class="token punctuation" >)</span><span class="token punctuation" >;</span>
  <span class="token punctuation" >}</span>

  <span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>
</code></pre>
<p>If you execute the build now using <code>npm run build</code>, you should see something along this:</p>
<pre><code class="lang-bash">Hash: dfc58c1bb4f22724671f
Version: webpack 2.2.0-rc.3
Time: 1836ms
        Asset       Size  Chunks             Chunk Names
       app.js    2.03 kB       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
    vendor.js     141 kB       1  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  vendor
      app.css    2.18 kB       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
   app.js.map    1.73 kB       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
  app.css.map   84 bytes       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  app
vendor.js.map     167 kB       1  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  vendor
   index.html  274 bytes          <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>
   <span class="token punctuation" >[</span>3<span class="token punctuation" >]</span> ./~/react/lib/ReactElement.js 11.2 kB <span class="token punctuation" >{</span>1<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
   <span class="token punctuation" >[</span>5<span class="token punctuation" >]</span> ./~/object-assign/index.js 1.99 kB <span class="token punctuation" >{</span>1<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
   <span class="token punctuation" >[</span>7<span class="token punctuation" >]</span> ./~/react/react.js 56 bytes <span class="token punctuation" >{</span>1<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
<span class="token punctuation" >..</span>.
</code></pre>
<p>Now our bundles look just the way we want. The image below illustrates the current situation:</p>
<p><img src="/webpack/images/bundle_02.png" alt="App and vendor bundles after applying `CommonsChunkPlugin`"></p>
<h2 class="header"><a class="header-anchor" href="#loading-dependencies-to-a-vendor-bundle-automatically" id="loading-dependencies-to-a-vendor-bundle-automatically"></a><span class="text">Loading <code>dependencies</code> to a <code>vendor</code> Bundle Automatically</span><a class="header-anchor-select" href="#loading-dependencies-to-a-vendor-bundle-automatically">#</a></h2>
<p>If you maintain strict separation between <code>dependencies</code> and <code>devDependencies</code>, you can make webpack pick up your <code>vendor</code> dependencies automatically based on this information. You avoid having to manage those manually then.</p>
<p>Instead of having <code>[&#39;react&#39;]</code>, we could go through <code>Object.keys</code> like this:</p>
<pre><code class="lang-javascript"><span class="token comment" spellcheck="true">// Filter based on need</span>
Object<span class="token punctuation" >.</span><span class="token function" >keys</span><span class="token punctuation" >(</span><span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'./package.json'</span><span class="token punctuation" >)</span><span class="token punctuation" >.</span>dependencies<span class="token punctuation" >)</span>
</code></pre>
<p>The problem is that this approach can bring unused dependencies to the vendor bundle. A better way to handle this is to use <code>CommonsChunkPlugin</code> and its <code>minChunks</code> parameter.</p>
<p>In addition to a number and certain other values, <code>minChunks</code> accepts a function. This makes it possible to deduce which modules are external without having to perform a lookup against <em>package.json</em>. To adapt Rafael De Leon&#39;s solution from <a href="http://stackoverflow.com/a/38733864/228885">Stack Overflow</a>, you could end up with code like this:</p>
<pre><code class="lang-javascript"><span class="token keyword" >new</span> <span class="token class-name" >webpack<span class="token punctuation" >.</span>optimize<span class="token punctuation" >.</span>CommonsChunkPlugin</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span>
  name<span class="token punctuation" >:</span> <span class="token string" >'vendor'</span><span class="token punctuation" >,</span>
  minChunks<span class="token punctuation" >:</span> <span class="token punctuation" >(</span>module<span class="token punctuation" >,</span> count<span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> <span class="token punctuation" >{</span>
    <span class="token keyword" >const</span> userRequest <span class="token operator" >=</span> module<span class="token punctuation" >.</span>userRequest<span class="token punctuation" >;</span>

    <span class="token comment" spellcheck="true">// You can perform other similar checks here too.</span>
    <span class="token comment" spellcheck="true">// Now we check just node_modules.</span>
    <span class="token keyword" >return</span> userRequest <span class="token operator" >&amp;&amp;</span> userRequest<span class="token punctuation" >.</span><span class="token function" >indexOf</span><span class="token punctuation" >(</span><span class="token string" >'node_modules'</span><span class="token punctuation" >)</span> <span class="token operator" >>=</span> <span class="token number" >0</span><span class="token punctuation" >;</span>
  <span class="token punctuation" >}</span>
<span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
</code></pre>
<p>The <code>module</code> parameter of <code>minChunks</code> contains a lot of data and you may want to <code>console.log</code> it to understand it in greater detail. <code>userRequest</code>, if it is set, contains the full path to the module that was imported. Therefore, the check above works.</p>
<p>Given <code>minChunks</code> receives <code>count</code> as its second parameter, you could force it to capture chunks based on usage. This is particularly useful in more complex setups where you have split your code multiple times and want more control over the result.</p>
<p>If you want to try out this technique, you can pass a custom <code>minChunks</code> check to <code>extractBundles</code> like above. The advantage of this approach is that it will use <strong>only</strong> dependencies you refer to in your application and you can eliminate the array.</p>
<h2 class="header"><a class="header-anchor" href="#chunk-types-in-webpack" id="chunk-types-in-webpack"></a><span class="text">Chunk Types in Webpack</span><a class="header-anchor-select" href="#chunk-types-in-webpack">#</a></h2>
<p>In the example above, we used something known as <strong>entry chunks</strong>. As <a href="https://webpack.github.io/docs/code-splitting.html#chunk-types">discussed in the documentation</a>, internally webpack treats chunks in three types:</p>
<ul>
<li><strong>Entry chunks</strong> - Entry chunks contain webpack runtime and modules it then loads. So far we&#39;ve been dealing with these.</li>
<li><strong>Normal chunks</strong> - Normal chunks <strong>don&#39;t</strong> contain webpack runtime. Instead, these can be loaded dynamically while the application is running. A suitable wrapper (JSONP for example) is generated for these. We&#39;ll generate a normal chunk in the next chapter as we set up code splitting.</li>
<li><strong>Initial chunks</strong> - Initial chunks are normal chunks that count towards initial loading time of the application and are generated by the <code>CommonsChunkPlugin</code>. As a user, you don&#39;t have to care about these. It&#39;s the split between entry chunks and normal chunks that&#39;s important.</li>
</ul>
<h2 class="header"><a class="header-anchor" href="#conclusion" id="conclusion"></a><span class="text">Conclusion</span><a class="header-anchor-select" href="#conclusion">#</a></h2>
<p>The situation is better now. Note how small <code>app</code> bundle compared to the <code>vendor</code> bundle. To really benefit from this split, we will set up caching in the next part of this book. But before that, we can learn about a technique known as <em>code splitting</em> to go even more granular.</p>
</div><div class="social-links"><blockquote class="tip">If you enjoyed this chapter, consider subscribing to the mailing list below or following <a href="https://twitter.com/survivejs">@survivejs</a> for occasional updates. There is also <a href="/atom.xml">RSS</a> available for old beards (no pun intended).</blockquote><h2 class="subscribe-header">Subscribe to the mailing list</h2><form action="//jster.us7.list-manage.com/subscribe/post?u=ed40c0084a0c5ba31b3365d65&amp;id=b853b8e786" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate social-form" target="_blank" novalidate=""><div id="mc_embed_signup_scroll"><div class="mc-field-group social-input-container"><input type="email" placeholder="Email" value="" name="EMAIL" class="required email" id="mce-EMAIL"/></div><div style="display:none;position:absolute;left:-5000px;"><input type="text" name="b_ed40c0084a0c5ba31b3365d65_b853b8e786" tabindex="-1" value=""/></div><div class="social-subscribe-container"><input type="submit" class="btn button social-subscribe" style="margin-top:1em;margin-bottom:1em;line-height:2em;" value="Subscribe" name="subscribe" id="mc-embedded-subscribe"/></div></div></form></div><div class="new-prevnext"><div class="new-prevnext__prev"><div class="new-prevnext__bg" style="background-image:url(/assets/img/chapters/wheels.jpg);"></div><span class="new-prevnext__info">Previous chapter</span><a class="new-prevnext__link" href="/webpack/building-with-webpack/enabling-sourcemaps">Enabling Sourcemaps</a></div><div class="new-prevnext__next"><div class="new-prevnext__bg" style="background-image:url(/assets/img/chapters/nuts.jpg);"></div><span class="new-prevnext__info">Next chapter</span><a class="new-prevnext__link" href="/webpack/building-with-webpack/code-splitting">Code Splitting</a></div></div><blockquote class="tip"><p>This book is <a href="https://leanpub.com/survivejs-webpack">available through Leanpub</a>. By purchasing the book you support the development of further content. A part of profit (~30%) goes to Tobias Koppers, the author of Webpack.</p></blockquote><div id="disqus_thread"></div></div></div><div><a class="next-page" title="Code Splitting" href="/webpack/building-with-webpack/code-splitting"><i class="icon-right-open"></i></a><a class="previous-page" title="Enabling Sourcemaps" href="/webpack/building-with-webpack/enabling-sourcemaps"><i class="icon-left-open"></i></a></div><script type="text/javascript">var disqus_shortname = 'survivejs';(function() {var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script></div><div class="nav__wrapper"><input type="checkbox" class="nav__toggle" id="nav__toggle"/><label class="nav__toggle-label" for="nav__toggle"></label><nav class="nav"><div class="nav__link"><a class="" href="/">Home</a></div><div class="nav__link"><a class="" href="/blog">Read the blog</a></div><div class="nav__link"><a class="" href="https://leanpub.com/survivejs-webpack">Buy the ebook</a></div><div class="nav__link"><a class="" href=""></a></div><div class="nav__link"><a class="" href="https://twitter.com/survivejs">@survivejs</a></div></nav></div><a href="https://github.com/survivejs/webpack" class="github-corner"><svg width="80" height="80" viewBox="0 0 250 250" style="position:absolute;top:0;fill:#000;right:0;"><path class="octo-banner" d="M0 0l115 115h15l12 27 108 108V0z" fill="#fff"></path><path class="octo-arm" d="M128 109c-15-9-9-19-9-19 3-7 2-11 2-11-1-7 3-2 3-2 4 5 2 11 2 11-3 10 5 15 9 16" style="-webkit-transform-origin:130px 106px;transform-origin:130px 106px;"></path><path class="octo-body" d="M115 115s4 2 5 0l14-14c3-2 6-3 8-3-8-11-15-24 2-41 5-5 10-7 16-7 1-2 3-7 12-11 0 0 5 3 7 16 4 2 8 5 12 9s7 8 9 12c14 3 17 7 17 7-4 8-9 11-11 11 0 6-2 11-7 16-16 16-30 10-41 2 0 3-1 7-5 11l-12 11c-1 1 1 5 1 5z"></path></svg></a><footer><div class="footer-wrapper"><div class="footer-content-wrapper"><div class="footer-social"><h3>Social</h3><ul><li><a href="https://twitter.com/survivejs" target="_blank">@survivejs</a></li><li><a href="http://eepurl.com/bth1v5" target="_blank">Mailing List</a></li><li><a href="https://gitter.im/survivejs" target="_blank">Gitter Chat</a></li><li><a href="https://github.com/survivejs" target="_blank">GitHub</a></li><li><a href="/atom.xml" target="_blank">Blog RSS</a></li><li><a href="http://goo.gl/forms/OWdGIOdHm9" target="_blank">Contact</a></li><li><a href="https://github.com/survivejs/ama/issues" target="_blank">Ask Me Anything</a></li></ul></div><div class="footer-blog"><h3>From the Blog</h3><ul class="blog-teasers"><li><a class="blog-teaser" href="/blog/isomorphic-webpack-interview">isomorphic-webpack - Universal module consumption using webpack - Interview with Gajus Kuizinas</a></li><li><a class="blog-teaser" href="/blog/survivejs-webpack-150">SurviveJS - Webpack - v1.5.0</a></li><li><a class="blog-teaser" href="/blog/styletron-interview">Styletron - Universal, high-performance JavaScript styles - Interview with Ryan Tsao</a></li><li><a class="blog-teaser" href="/blog/survivejs-webpack-142">SurviveJS - Webpack - v1.4.2</a></li><li><a class="blog-teaser" href="/blog/inferno-interview">Inferno - Blazing fast, React-like UI library - Interview with Dominic Gannaway</a></li><li><a class="blog-teaser" href="/blog/svelte-interview">Svelte - The magical disappearing UI framework - Interview with Rich Harris</a></li><li><a class="blog-teaser" href="/blog/webpack-merge-interview">webpack-merge - Taming Webpack Configuration - Interview with Juho Vepsäläinen</a></li><li><a class="blog-teaser" href="/blog/starratio-interview">StarRatio - Compare JavaScript Projects - Interview with Dmitry Zaets</a></li><li><a class="blog-teaser" href="/blog/redom-interview">RE:DOM - Tiny but Super Fast DOM Library - Interview with Juha Lindstedt</a></li><li><a class="blog-teaser" href="/blog/glamor-interview">Glamor - Inline CSS for React et al - Interview with Sunil Pai</a></li></ul></div></div></div></footer><div><div class="gitter-open-chat-button">Need help?</div><script type="text/javascript">
            ((window.gitter = {}).chat = {}).options = {
              showChatByDefault: false,
              activationElement: '.gitter-open-chat-button',
              room: 'survivejs/webpack'
            };
          </script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async="" defer=""></script></div><div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script type="text/javascript">
            docsearch({
              apiKey: '1182e3806d62e921613b8dc9c7a22ef3',
              indexName: 'survivejs_webpack',
              inputSelector: '#search',
              debug: false
            });
          </script></div></main></body></html>