<html lang="en"><head><title>Bundling Libraries</title><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimal-ui"/><meta name="description" content="
To understand webpack&#x27;s library targets better, you could set up a small library to bundle. The idea is to end up with a non-minified, a minified version, and a version compatible with package.json module field. The first two can be used for standalone consumption. You can also point to the non-minâ€¦"/><meta name="keywords" content="webpack,react,javascript,programming,web development"/><link rel="icon" type="image/png" href="/assets/img/favicon.png"/><link rel="alternate" type="application/atom+xml" href="/atom.xml"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"/><link rel="stylesheet" href="/assets/main.css"/></head><body><main role="main"><div class="chapter__wrapper"><div class="header-image" style="background-image:url(/assets/img/chapters/books.jpg);"></div><h1 class="post__heading">Bundling Libraries</h1><div class="header-extra"><a href="https://pixabay.com/en/old-books-book-old-library-436498/">jarmoluk (Public Domain)</a></div><div class="toc-nav__wrapper"><h4 class="search-nav--header">Search</h4><input id="search"/><h4 class="toc-nav--header">Table of Contents</h4><ul class="toc-nav"><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/foreword">Foreword</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/preface">Preface</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/introduction">Introduction</a></li><li class="toc-intro"><a class="toc-nav__link intro" href="/webpack/what-is-webpack">What is Webpack</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/developing">Developing</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/getting-started">Getting Started</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/automatic-browser-refresh">Automatic Browser Refresh</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/linting">Linting JavaScript</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/developing/composing-configuration">Composing Configuration</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/styling">Styling</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/loading">Loading Styles</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/separating-css">Separating CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/autoprefixing">Autoprefixing</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/eliminating-unused-css">Eliminating Unused CSS</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/styling/linting">Linting CSS</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/loading">Loading Assets</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/loader-definitions">Loader Definitions</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/images">Loading Images</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/fonts">Loading Fonts</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/loading/javascript">Loading JavaScript</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/building">Building</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/source-maps">Source Maps</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/bundle-splitting">Bundle Splitting</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/code-splitting">Code Splitting</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/building/tidying-up">Tidying Up</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/optimizing">Optimizing</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/minifying">Minifying</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/tree-shaking">Tree Shaking</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/environment-variables">Environment Variables</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/adding-hashes-to-filenames">Adding Hashes to Filenames</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/separating-manifest">Separating a Manifest</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/analyzing-build-statistics">Analyzing Build Statistics</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/optimizing/performance">Performance</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/output">Output</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/output/targets">Build Targets</a></li><li class="toc-chapter"><span class="toc-nav__link toc-nav__link--current chapter">Bundling Libraries</span></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/output/library-output">Library Output</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/output/multiple-pages">Multiple Pages</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/output/server-side-rendering">Server Side Rendering</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/techniques">Techniques</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/dynamic-loading">Dynamic Loading</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/web-workers">Web Workers</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/i18n">Internationalization</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/testing">Testing</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/techniques/deploying">Deploying Applications</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/packages">Packages</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/packages/consuming">Consuming Packages</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/packages/consuming-techniques">Package Consuming Techniques</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/packages/authoring">Authoring Packages</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/packages/authoring-techniques">Package Authoring Techniques</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/extending">Extending</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/extending/loaders">Extending with Loaders</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/extending/plugins">Extending with Plugins</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/conclusion">Conclusion</a></li><li class="toc-part"><a class="toc-nav__link part" href="/webpack/appendices">Appendices</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/comparison">Comparison of Build Tools</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/hmr">Hot Module Replacement</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/hmr-with-react">Hot Module Replacement with React</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/customizing-eslint">Customizing ESLint</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/searching-with-react">Searching with React</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/troubleshooting">Troubleshooting</a></li><li class="toc-chapter"><a class="toc-nav__link chapter" href="/webpack/appendices/glossary">Glossary</a></li></ul><div><div class="buy-container"><a href="/webpack/foreword"><img class="sidebar-cover" src="/assets/img/webpack_title_page_small.png" width="255" height="329"/></a><p><a class="btn btn--normal btn--buy" href="https://leanpub.com/survivejs-webpack">Buy at Leanpub</a><a class="btn btn--normal btn--buy" href="https://www.amazon.com/dp/9526868803/">Buy at Amazon</a><a class="btn btn--normal btn--buy" href="https://www.amazon.com/dp/B06XWZZGBS">Buy for Kindle</a><a class="btn btn--normal btn--buy" href="https://survivejs.typeform.com/to/LUQK0T">Buy Signed LE</a></p></div><h3>See also</h3><div class="buy-container"><a href="/react/introduction"><img class="sidebar-cover" src="/assets/img/react_title_page_small.png" width="255" height="329"/></a><p><a class="btn btn--normal btn--buy" href="https://leanpub.com/survivejs-react">Buy at Leanpub</a></p></div></div></div><div class="chapter"><div class="post__content"><blockquote class="latestpost tip"><div>From the blog:</div><a class="latestpost-link" href="/blog/async-reactor-interview">async-reactor - Render Async Stateless Functional Components in React - Interview with Sven Sauleau</a></blockquote><div class="chapter-content"><p>To understand webpack&#39;s library targets better, you could set up a small library to bundle. The idea is to end up with a non-minified, a minified version, and a version compatible with <em>package.json</em> <code>module</code> field. The first two can be used for standalone consumption. You can also point to the non-minified version through <em>package.json</em> <code>main</code>.</p>
<h2 class="header"><a class="header-anchor" href="#setting-up-a-library" id="setting-up-a-library"></a><span class="text">Setting Up a Library</span><a class="header-anchor-select" href="#setting-up-a-library">#</a></h2>
<p>To have something to build, set up a module as follows:</p>
<p><strong>lib/index.js</strong></p>
<pre><code class="lang-javascript"><span class="token keyword" >const</span> add <span class="token operator" >=</span> <span class="token punctuation" >(</span>a<span class="token punctuation" >,</span> b<span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> a <span class="token operator" >+</span> b<span class="token punctuation" >;</span>

<span class="token keyword" >export</span> <span class="token punctuation" >{</span>
  add<span class="token punctuation" >,</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>
</code></pre>
<p>The idea is that this file becomes the entry point for the entire library and represents the API exposed to the consumers. If you want to support both CommonJS and ES6, it can be a good idea to use the CommonJS module definition here. If you go with ES6 <code>export default</code>, using such an export in a CommonJS environment often requires extra effort.</p>
<h2 class="header"><a class="header-anchor" href="#setting-up-an-npm-script" id="setting-up-an-npm-script"></a><span class="text">Setting Up an npm Script</span><a class="header-anchor-select" href="#setting-up-an-npm-script">#</a></h2>
<p>Given the <code>build</code> target of the project has been taken already by the main application, you should set up a separate one for generating the library. It points to a library specific configuration file to keep things nice and tidy.</p>
<p><strong>package.json</strong></p>
<pre><code class="lang-json"><span class="token property" >"scripts"</span><span class="token operator" >:</span> <span class="token punctuation" >{</span>
<div class="leanpub-insert">
  "build<span class="token operator" >:</span>lib"<span class="token operator" >:</span> <span class="token string" >"webpack --config webpack.lib.js"</span><span class="token punctuation" >,</span>
</div>
  ...
<span class="token punctuation" >}</span><span class="token punctuation" >,</span>
</code></pre>
<h2 class="header"><a class="header-anchor" href="#setting-up-webpack" id="setting-up-webpack"></a><span class="text">Setting Up Webpack</span><a class="header-anchor-select" href="#setting-up-webpack">#</a></h2>
<p>Webpack configuration itself can be adapted from the one you built. This time, however, you have to generate two files - a non-minified version and a minified one. This can be achieved by running webpack in so called <em>multi-compiler mode</em>. It means you can expose an array of configurations for webpack and it executes each.</p>
<p><strong>webpack.lib.js</strong></p>
<pre><code class="lang-javascript"><span class="token keyword" >const</span> path <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'path'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token keyword" >const</span> merge <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'webpack-merge'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

<span class="token keyword" >const</span> parts <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'./webpack.parts'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

<span class="token keyword" >const</span> PATHS <span class="token operator" >=</span> <span class="token punctuation" >{</span>
  lib<span class="token punctuation" >:</span> path<span class="token punctuation" >.</span><span class="token function" >join</span><span class="token punctuation" >(</span>__dirname<span class="token punctuation" >,</span> <span class="token string" >'lib'</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
  build<span class="token punctuation" >:</span> path<span class="token punctuation" >.</span><span class="token function" >join</span><span class="token punctuation" >(</span>__dirname<span class="token punctuation" >,</span> <span class="token string" >'dist'</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>

<span class="token keyword" >const</span> commonConfig <span class="token operator" >=</span> <span class="token function" >merge</span><span class="token punctuation" >(</span><span class="token punctuation" >[</span>
  <span class="token punctuation" >{</span>
    entry<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
      lib<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>lib<span class="token punctuation" >,</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
    output<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
      path<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>build<span class="token punctuation" >,</span>
      library<span class="token punctuation" >:</span> <span class="token string" >'Demo'</span><span class="token punctuation" >,</span>
      libraryTarget<span class="token punctuation" >:</span> <span class="token string" >'var'</span><span class="token punctuation" >,</span> <span class="token comment" spellcheck="true">// Default</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  parts<span class="token punctuation" >.</span><span class="token function" >attachRevision</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
  parts<span class="token punctuation" >.</span><span class="token function" >generateSourceMaps</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span> type<span class="token punctuation" >:</span> <span class="token string" >'source-map'</span> <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
  parts<span class="token punctuation" >.</span><span class="token function" >loadJavaScript</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span> include<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>app <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
<span class="token punctuation" >]</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

<span class="token keyword" >const</span> libraryConfig <span class="token operator" >=</span> <span class="token function" >merge</span><span class="token punctuation" >(</span><span class="token punctuation" >[</span>
  commonConfig<span class="token punctuation" >,</span>
  <span class="token punctuation" >{</span>
    output<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
      filename<span class="token punctuation" >:</span> <span class="token string" >'[name].js'</span><span class="token punctuation" >,</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
<span class="token punctuation" >]</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

<span class="token keyword" >const</span> libraryMinConfig <span class="token operator" >=</span> <span class="token function" >merge</span><span class="token punctuation" >(</span><span class="token punctuation" >[</span>
  commonConfig<span class="token punctuation" >,</span>
  <span class="token punctuation" >{</span>
    output<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
      filename<span class="token punctuation" >:</span> <span class="token string" >'[name].min.js'</span><span class="token punctuation" >,</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  parts<span class="token punctuation" >.</span><span class="token function" >minifyJavaScript</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
<span class="token punctuation" >]</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token punctuation" >[</span>
  libraryConfig<span class="token punctuation" >,</span>
  libraryMinConfig<span class="token punctuation" >,</span>
<span class="token punctuation" >]</span><span class="token punctuation" >;</span>
</code></pre>
<p>If you execute <code>npm run build:lib</code> now, you should see output:</p>
<pre><code class="lang-bash">Hash: 760c4d25403432782e1079cf0c3f76bbd168a80c
Version: webpack 2.2.1
Child
    Hash: 760c4d25403432782e10
    Time: 302ms
         Asset     Size  Chunks             Chunk Names
        lib.js  2.96 kB       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  lib
    lib.js.map  2.85 kB       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  lib
       <span class="token punctuation" >[</span>0<span class="token punctuation" >]</span> ./lib/index.js 55 bytes <span class="token punctuation" >{</span>0<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
Child
    Hash: 79cf0c3f76bbd168a80c
    Time: 291ms
             Asset       Size  Chunks             Chunk Names
        lib.min.js  695 bytes       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  lib
    lib.min.js.map    6.72 kB       0  <span class="token punctuation" >[</span>emitted<span class="token punctuation" >]</span>  lib
       <span class="token punctuation" >[</span>0<span class="token punctuation" >]</span> ./lib/index.js 55 bytes <span class="token punctuation" >{</span>0<span class="token punctuation" >}</span> <span class="token punctuation" >[</span>built<span class="token punctuation" >]</span>
</code></pre>
<p>Webpack ran twice in this case. It can be argued that it would be smarter to minify the initial result separately. In this case, the overhead is so small that it&#39;s not worth the extra setup.</p>
<p>Examining the build output reveals more:</p>
<p><strong>dist/lib.js</strong></p>
<pre><code class="lang-javascript"><span class="token comment" spellcheck="true">/*! 33c69fc */</span>
<span class="token keyword" >var</span> Demo <span class="token operator" >=</span>
<span class="token comment" spellcheck="true">/******/</span> <span class="token punctuation" >(</span><span class="token keyword" >function</span><span class="token punctuation" >(</span>modules<span class="token punctuation" >)</span> <span class="token punctuation" >{</span> <span class="token comment" spellcheck="true">// webpackBootstrap</span>
<span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
<span class="token comment" spellcheck="true">/******/</span> <span class="token punctuation" >}</span><span class="token punctuation" >)</span>
<span class="token comment" spellcheck="true">/************************************************************************/</span>
<span class="token comment" spellcheck="true">/******/</span> <span class="token punctuation" >(</span><span class="token punctuation" >[</span>
<span class="token comment" spellcheck="true">/* 0 */</span>
<span class="token comment" spellcheck="true">/***/</span> <span class="token punctuation" >(</span><span class="token keyword" >function</span><span class="token punctuation" >(</span>module<span class="token punctuation" >,</span> __webpack_exports__<span class="token punctuation" >,</span> __webpack_require__<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>

<span class="token string" >"use strict"</span><span class="token punctuation" >;</span>
Object<span class="token punctuation" >.</span><span class="token function" >defineProperty</span><span class="token punctuation" >(</span>__webpack_exports__<span class="token punctuation" >,</span> <span class="token string" >"__esModule"</span><span class="token punctuation" >,</span> <span class="token punctuation" >{</span> value<span class="token punctuation" >:</span> <span class="token boolean" >true</span> <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token comment" spellcheck="true">/* harmony export (binding) */</span> __webpack_require__<span class="token punctuation" >.</span><span class="token function" >d</span><span class="token punctuation" >(</span>__webpack_exports__<span class="token punctuation" >,</span> <span class="token string" >"add"</span><span class="token punctuation" >,</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span> <span class="token keyword" >return</span> add<span class="token punctuation" >;</span> <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token keyword" >var</span> add <span class="token operator" >=</span> <span class="token keyword" >function</span> <span class="token function" >add</span><span class="token punctuation" >(</span>a<span class="token punctuation" >,</span> b<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
  <span class="token keyword" >return</span> a <span class="token operator" >+</span> b<span class="token punctuation" >;</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>

<span class="token comment" spellcheck="true">/***/</span> <span class="token punctuation" >}</span><span class="token punctuation" >)</span>
<span class="token comment" spellcheck="true">/******/</span> <span class="token punctuation" >]</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token comment" spellcheck="true">//# sourceMappingURL=lib.js.map</span>
</code></pre>
<p>You can see familiar code there and more. Webpack&#39;s bootstrap script is in place, and it starts the entire execution process. It takes the majority of space for a small library, but that&#39;s not a problem as the library begins to grow.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>Instead of using the multi-compiler mode, it would be possible to define two targets. One of them would generate the non-minified version while the other would generate the minified one. The other npm script could be called as <code>build:lib:dist</code> and you could define a <code>build:lib:all</code> script to build both.</blockquote><h2 class="header"><a class="header-anchor" href="#cleaning-and-linting-before-building" id="cleaning-and-linting-before-building"></a><span class="text">Cleaning and Linting Before Building</span><a class="header-anchor-select" href="#cleaning-and-linting-before-building">#</a></h2>
<p>It&#39;s a good idea to clean the build directory and lint the code before building the library. You could expand webpack configuration:</p>
<pre><code class="lang-javascript"><span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>

<span class="token keyword" >const</span> libraryConfig <span class="token operator" >=</span> <span class="token function" >merge</span><span class="token punctuation" >(</span><span class="token punctuation" >[</span>
  commonConfig<span class="token punctuation" >,</span>
  <span class="token punctuation" >{</span>
    output<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
      filename<span class="token punctuation" >:</span> <span class="token string" >'[name].js'</span><span class="token punctuation" >,</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
  <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
<div class="leanpub-insert">
  parts<span class="token punctuation" >.</span><span class="token function" >clean</span><span class="token punctuation" >(</span>PATHS<span class="token punctuation" >.</span>build<span class="token punctuation" >)</span><span class="token punctuation" >,</span>
  parts<span class="token punctuation" >.</span><span class="token function" >lintJavaScript</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span> include<span class="token punctuation" >:</span> PATHS<span class="token punctuation" >.</span>lib <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >,</span>
</div>
<span class="token punctuation" >]</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

<span class="token punctuation" >.</span><span class="token punctuation" >.</span><span class="token punctuation" >.</span>
</code></pre>
<p><code>parts.clean</code> and <code>parts.lintJavaScript</code> were included to <code>libraryConfig</code> on purpose as it makes sense to run them only once at the beginning of the execution. This solution would be problematic with <em>parallel-webpack</em> though as it can run configurations out of order.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>There&#39;s <a href="https://github.com/webpack/webpack/issues/4271">a proposal to improve the situation</a> by introducing the concepts of pre- and post-processing to webpack.</blockquote><h2 class="header"><a class="header-anchor" href="#cleaning-and-linting-through-npm" id="cleaning-and-linting-through-npm"></a><span class="text">Cleaning and Linting Through npm</span><a class="header-anchor-select" href="#cleaning-and-linting-through-npm">#</a></h2>
<p>Another, and in this case a more fitting, way would be to handle the problem through an npm script. As discussing in the <a href="/webpack/packages/authoring-techniques">Package Authoring Techniques</a> chapter, npm provides pre- and post-script hooks. To keep this solution cross-platform, install <a href="https://www.npmjs.com/package/rimraf">rimraf</a> first:</p>
<pre><code class="lang-bash">npm <span class="token function" >install</span> rimraf --save-dev
</code></pre>
<p>Then, to remove the build directory and lint the source before building, adjust as follows:</p>
<p><strong>package.json</strong></p>
<pre><code class="lang-json"><span class="token property" >"scripts"</span><span class="token operator" >:</span> <span class="token punctuation" >{</span>
<div class="leanpub-insert">
  "prebuild<span class="token operator" >:</span>lib"<span class="token operator" >:</span> <span class="token string" >"npm run lint:js &amp;&amp; rimraf dist"</span><span class="token punctuation" >,</span>
</div>
  ...
<span class="token punctuation" >}</span><span class="token punctuation" >,</span>
</code></pre>
<p>If either process fails, npm doesn&#39;t proceed to the <code>lib</code> script. You can verify this by breaking a linting rule and seeing what happens when you build (<code>npm run build:lib</code>). Instead, it gives you an error.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>To get cleaner error output, run either <code>npm run build:lib --silent</code> or <code>npm run build:lib -s</code>.</blockquote><blockquote class="tip"><i class="icon-attention-circled"></i>The same idea can be used for post-processes, such as deployment. For example, you could set up a <code>postpublish</code> script to deploy the library site after you have published it to npm.</blockquote><h2 class="header"><a class="header-anchor" href="#conclusion" id="conclusion"></a><span class="text">Conclusion</span><a class="header-anchor-select" href="#conclusion">#</a></h2>
<p>Webpack can be used for bundling libraries. You can use it to generate multiple different output files based on your exact needs.</p>
<p>To recap:</p>
<ul>
<li>If you bundle libraries with webpack, you should set the <code>output</code> options carefully to get the result you want.</li>
<li>Webpack can generate both a non-minified and a minified version of a library through its <strong>multi-compiler</strong> mode. It&#39;s possible to minify also as a post-process using an external tool.</li>
<li>Performing tasks, such as cleaning and linting JavaScript, while using the multi-compiler mode is problematic at the moment. Instead, it can be a good idea to handle these tasks outside of webpack or run multiple webpack instances separately.</li>
</ul>
<p>If you try to import <em>./dist/lib.js</em> through Node, you notice it emits <code>{}</code>. The problem has to do with the output type that was chosen. To understand better which output to use and why, the next chapter covers them in detail.</p>
<blockquote class="tip"><i class="icon-attention-circled"></i>The <a href="/webpack/packages/authoring-techniques">Package Authoring Techniques</a> chapter discusses npm specific techniques in detail.</blockquote></div><div class="social-links"><blockquote class="tip">If you enjoyed this chapter, consider subscribing to the mailing list below or following <a href="https://twitter.com/survivejs">@survivejs</a> for occasional updates. There is also <a href="/atom.xml">RSS</a> available for old beards (no pun intended).</blockquote><h2 class="subscribe-header">Subscribe to the mailing list</h2><form action="//jster.us7.list-manage.com/subscribe/post?u=ed40c0084a0c5ba31b3365d65&amp;id=b853b8e786" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate social-form" target="_blank" novalidate=""><div id="mc_embed_signup_scroll"><div class="mc-field-group social-input-container"><input type="email" placeholder="Email" value="" name="EMAIL" class="required email" id="mce-EMAIL"/></div><div style="display:none;position:absolute;left:-5000px;"><input type="text" name="b_ed40c0084a0c5ba31b3365d65_b853b8e786" tabindex="-1" value=""/></div><div class="social-subscribe-container"><input type="submit" class="btn button social-subscribe" style="margin-top:1em;margin-bottom:1em;line-height:2em;" value="Subscribe" name="subscribe" id="mc-embedded-subscribe"/></div></div></form></div><div class="new-prevnext"><div class="new-prevnext__prev"><div class="new-prevnext__bg" style="background-image:url(/assets/img/chapters/darts.jpg);"></div><span class="new-prevnext__info">Previous chapter</span><a class="new-prevnext__link" href="/webpack/output/targets">Build Targets</a></div><div class="new-prevnext__next"><div class="new-prevnext__bg" style="background-image:url(/assets/img/chapters/library.jpg);"></div><span class="new-prevnext__info">Next chapter</span><a class="new-prevnext__link" href="/webpack/output/library-output">Library Output</a></div></div><blockquote class="tip"><p>This book is available through <a href="https://leanpub.com/survivejs-webpack">Leanpub (digital)</a>, <a href="https://www.amazon.com/dp/9526868803">Amazon (paperback)</a>, and <a href="https://www.amazon.com/dp/B06XWZZGBS">Kindle (digital)</a>. By purchasing the book you support the development of further content. A part of profit (~30%) goes to Tobias Koppers, the author of webpack.</p></blockquote><div id="disqus_thread"></div></div></div><div><a class="next-page" title="Library Output" href="/webpack/output/library-output"><i class="icon-right-open"></i></a><a class="previous-page" title="Build Targets" href="/webpack/output/targets"><i class="icon-left-open"></i></a></div><script type="text/javascript">var disqus_shortname = 'survivejs';(function() {var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script></div><div class="nav__wrapper"><input type="checkbox" class="nav__toggle" id="nav__toggle"/><label class="nav__toggle-label" for="nav__toggle"></label><nav class="nav"><div class="nav__link"><a class="" href="/">Home</a></div><div class="nav__link"><a class="" href="/blog/">Read the blog</a></div><div class="nav__link"><a class="" href="/training/">Get training</a></div><div class="nav__link"><a class="" href="https://leanpub.com/survivejs-webpack">Buy the ebook</a></div><div class="nav__link"><a class="" href=""></a></div><div class="nav__link"><a class="" href="https://twitter.com/survivejs">@survivejs</a></div></nav></div><a href="https://github.com/survivejs/site" class="github-corner"><svg width="80" height="80" viewBox="0 0 250 250" style="position:absolute;top:0;fill:#000;right:0;"><path class="octo-banner" d="M0 0l115 115h15l12 27 108 108V0z" fill="#fff"></path><path class="octo-arm" d="M128 109c-15-9-9-19-9-19 3-7 2-11 2-11-1-7 3-2 3-2 4 5 2 11 2 11-3 10 5 15 9 16" style="-webkit-transform-origin:130px 106px;transform-origin:130px 106px;"></path><path class="octo-body" d="M115 115s4 2 5 0l14-14c3-2 6-3 8-3-8-11-15-24 2-41 5-5 10-7 16-7 1-2 3-7 12-11 0 0 5 3 7 16 4 2 8 5 12 9s7 8 9 12c14 3 17 7 17 7-4 8-9 11-11 11 0 6-2 11-7 16-16 16-30 10-41 2 0 3-1 7-5 11l-12 11c-1 1 1 5 1 5z"></path></svg></a><footer><div class="footer-wrapper"><div class="footer-content-wrapper"><div class="footer-social"><h3>Social</h3><ul><li><a href="https://twitter.com/survivejs" target="_blank">@survivejs</a></li><li><a href="http://eepurl.com/bth1v5" target="_blank">Mailing List</a></li><li><a href="https://gitter.im/survivejs" target="_blank">Gitter Chat</a></li><li><a href="https://github.com/survivejs" target="_blank">GitHub</a></li><li><a href="https://presentations.survivejs.com" target="_blank">Presentations</a></li><li><a href="/training/" target="_blank">Training</a></li><li><a href="/atom.xml" target="_blank">Blog RSS</a></li><li><a href="http://goo.gl/forms/OWdGIOdHm9" target="_blank">Contact</a></li><li><a href="https://github.com/survivejs/ama/issues" target="_blank">Ask Me Anything</a></li></ul></div><div class="footer-blog"><h3>From the Blog</h3><ul class="blog-teasers"><li><a class="blog-teaser" href="/blog/async-reactor-interview">async-reactor - Render Async Stateless Functional Components in React - Interview with Sven Sauleau</a></li><li><a class="blog-teaser" href="/blog/webpackbin-interview">WebpackBin - Webpack Code Sandbox - Interview with Christian Alfoni</a></li><li><a class="blog-teaser" href="/blog/euro-tour-2017-recap">SurviveJS Euro Tour 2017 Recap</a></li><li><a class="blog-teaser" href="/blog/fluture-interview">Fluture - Fantasy Land compliant alternative to Promises - Interview with Aldwin Vlasblom</a></li><li><a class="blog-teaser" href="/blog/codesandbox-interview">CodeSandbox - Online React Playground - Interview with Ives van Hoorne</a></li><li><a class="blog-teaser" href="/blog/scrimba-interview">Scrimba - Interactive Screencasts Created in an Instant - Interview with Per Harald Borgen</a></li><li><a class="blog-teaser" href="/blog/survivejs-webpack-20-results-errata">SurviveJS - Webpack - v2.0 - Results and Errata</a></li><li><a class="blog-teaser" href="/blog/sanctuary-interview">Sanctuary - Refuge from unsafe JavaScript - Interview with David Chambers</a></li><li><a class="blog-teaser" href="/blog/rambda-interview">Rambda - Faster and Smaller Alternative to Ramda - Interview with Dejan Toteff</a></li><li><a class="blog-teaser" href="/blog/survivejs-webpack-20">SurviveJS - Webpack - v2.0</a></li></ul></div></div></div></footer><div><div class="gitter-open-chat-button">Need help?</div><script type="text/javascript">
            ((window.gitter = {}).chat = {}).options = {
              showChatByDefault: false,
              activationElement: '.gitter-open-chat-button',
              room: 'survivejs/webpack'
            };
          </script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async="" defer=""></script></div><div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script type="text/javascript">
            docsearch({
              apiKey: '1182e3806d62e921613b8dc9c7a22ef3',
              indexName: 'survivejs_webpack',
              inputSelector: '#search',
              debug: false
            });
          </script></div></main></body></html>